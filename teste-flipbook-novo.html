<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teste Flipbook Novo</title>
  <style>
    :root{
      --book-w: 900px;          /* largura total do livro aberto */
      --book-h: 600px;          /* altura do livro */
      --page-gap: 10px;         /* espaço no meio (dorso) */
      --paper: #fff;
      --ink: #111;
      --ui-bg: #0f172a;         /* slate-900 */
      --ui-fg: #e2e8f0;         /* slate-200 */
      --accent: #38bdf8;        /* sky-400 */
      --shadow: rgba(0,0,0,.25);
    }

    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
      background: linear-gradient(120deg,#0b1020 0%, #111827 100%);
      color:var(--ui-fg);
      display:flex; flex-direction:column; align-items:center; gap:16px; padding:24px;
    }

    /* --- Shell responsivo --- */
    .book-shell{
      width:min(95vw, var(--book-w));
      aspect-ratio: 3 / 2;                /* aproximação para manter proporção */
      max-height: var(--book-h);
      position:relative;
      perspective: 2000px;
      user-select:none;
    }

    /* --- Área do livro --- */
    .book{
      position:absolute; inset:0;
      display:grid; grid-template-columns: 1fr var(--page-gap) 1fr; gap:0;
      filter: drop-shadow(0 10px 25px var(--shadow));
    }

    .spine{ background: #1f2937; }

    .page{
      position:relative; overflow:hidden;
      background: var(--paper);
      color: var(--ink);
    }

    .page img, .page-content{ width:100%; height:100%; object-fit:cover; display:block; }
    .page-content{ padding:22px; overflow:auto; }

    /* --- Páginas que viram (lado direito empilha por cima) --- */
    .stack{ position:absolute; inset:0; transform-style:preserve-3d; transform-origin: left center; }
    .stack .face{ position:absolute; inset:0; backface-visibility:hidden; }
    .stack .front{ background:var(--paper); }
    .stack .back{ background:var(--paper); transform: rotateY(180deg); }

    /* sombras sutis durante a virada */
    .stack::before, .stack::after{
      content:""; position:absolute; inset:0; pointer-events:none; opacity:0; transition:opacity .25s ease;
    }
    .stack::before{ background: linear-gradient(90deg, rgba(0,0,0,.18), transparent 35%, transparent 65%, rgba(0,0,0,.18)); }
    .stack::after{ box-shadow: inset 0 0 80px rgba(0,0,0,.25); }

    .flipping .stack::before, .flipping .stack::after{ opacity:1; }

    /* Estado das folhas à direita: empilhadas e fechadas */
    .right .stack{ transform: rotateY(0deg); }

    /* Folhas que já foram viradas para a esquerda */
    .left .stack{ transform-origin: right center; transform: rotateY(-180deg); }

    /* Página interativa invisível para clique (hotzones) */
    .hotzone{
      position:absolute; inset:0; display:grid; grid-template-columns: 1fr 1fr;
    }
    .hotzone div{ cursor:pointer; }
    .hotzone div:hover{ background: rgba(56,189,248,.08); }

    /* --- Controles --- */
    .controls{
      display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:center;
      background: rgba(2,6,23,.6); padding:10px 12px; border-radius:16px; border:1px solid rgba(148,163,184,.2);
    }
    button, .pager{
      appearance:none; border:1px solid rgba(148,163,184,.2); border-radius:999px; padding:10px 14px;
      background:#0b1220; color:var(--ui-fg); font-weight:600; cursor:pointer; transition: transform .05s ease;
    }
    button:active{ transform: translateY(1px) }
    button[disabled]{ opacity:.5; cursor:not-allowed }
    .pager{ min-width:120px; text-align:center }
    .accent{ border-color:transparent; background: linear-gradient(90deg, #0ea5e9, #22d3ee); color:#051322; }

    /* Thumbs */
    .thumbs{ display:flex; gap:6px; overflow:auto; max-width:min(95vw, var(--book-w)); padding:2px; }
    .thumbs img{ height:68px; border-radius:8px; opacity:.6; border:2px solid transparent; cursor:pointer; }
    .thumbs img.active{ opacity:1; border-color: var(--accent); }
  </style>
</head>
<body>
  <header>
    <h1>Teste Flipbook Novo - Kelly Magalhães</h1>
    <p>Testando o novo sistema de flipbook com CSS Transform</p>
  </header>

  <div class="book-shell" aria-label="Flipbook" role="region">
    <div class="book" id="book">
      <div class="page left" id="left-page"></div>
      <div class="spine"></div>
      <div class="page right" id="right-page"></div>
    </div>
    <div class="hotzone" aria-hidden="true">
      <div id="hot-prev" title="Página anterior" aria-label="Página anterior"></div>
      <div id="hot-next" title="Próxima página" aria-label="Próxima página"></div>
    </div>
  </div>

  <div class="controls" aria-label="Controles do flipbook">
    <button id="first">⏮ Início</button>
    <button id="prev">◀ Anterior</button>
    <div class="pager" id="pager">p. 1–2</div>
    <button id="next" class="accent">Próxima ▶</button>
    <button id="last">Fim ⏭</button>
  </div>

  <div class="thumbs" id="thumbs" aria-label="Miniaturas"></div>

  <script>
    // ================= CONFIGURAÇÃO =================
    // Teste com algumas páginas da revista 1930
    const PAGES = [
      'REVISTA/1930/Pag1.jpg',
      'REVISTA/1930/Pag2.jpg',
      'REVISTA/1930/Pag3.jpg',
      'REVISTA/1930/Pag4.jpg',
      'REVISTA/1930/Pag5.jpg',
      'REVISTA/1930/Pag6.jpg'
    ];

    // Se preferir sentido RTL (direita→esquerda), troque para true
    const RTL = false;

    // Pré-carregamento leve
    const preloadRadius = 2; // páginas antes/depois

    // ================= IMPLEMENTAÇÃO =================
    const bookEl = document.getElementById('book');
    const leftEl = document.getElementById('left-page');
    const rightEl = document.getElementById('right-page');
    const pager = document.getElementById('pager');
    const thumbs = document.getElementById('thumbs');

    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const firstBtn = document.getElementById('first');
    const lastBtn = document.getElementById('last');

    const hotPrev = document.getElementById('hot-prev');
    const hotNext = document.getElementById('hot-next');

    let spreadIndex = 0; // índice da dupla (0 = páginas 1–2)

    // Cria elementos empilhados (folhas) para o lado direito
    function renderStack(){
      rightEl.innerHTML = '';
      const total = PAGES.length;
      for(let i=0;i<total;i++){
        const stack = document.createElement('div');
        stack.className = 'stack';
        stack.style.zIndex = String(1000 - i); // topo é a última página

        const front = document.createElement('div');
        front.className = 'face front';
        const imgFront = document.createElement('img');
        imgFront.decoding = 'async';
        imgFront.loading = 'lazy';
        imgFront.src = PAGES[i];
        front.appendChild(imgFront);

        const back = document.createElement('div');
        back.className = 'face back';
        // verso mostra a próxima página, se existir
        const backIdx = i+1;
        if(backIdx < total){
          const imgBack = document.createElement('img');
          imgBack.decoding = 'async';
          imgBack.loading = 'lazy';
          imgBack.src = PAGES[backIdx];
          back.appendChild(imgBack);
        }else{
          back.innerHTML = '<div class="page-content">Fim</div>';
        }

        stack.appendChild(front);
        stack.appendChild(back);

        rightEl.appendChild(stack);
      }
    }

    function updateView(animate=true){
      // define quantas folhas já foram viradas (2 páginas por spread)
      const turned = Math.min(PAGES.length, Math.max(0, spreadIndex*2));

      // esquerda recebe as folhas já viradas
      leftEl.classList.add('left');
      rightEl.classList.add('right');

      const stacks = [...rightEl.querySelectorAll('.stack')];
      const total = stacks.length;

      // aplica transform em cada folha (<= turned vira para a esquerda)
      stacks.forEach((stack, i) => {
        const isTurned = i < turned;
        const origin = isTurned ? 'right center' : 'left center';
        stack.style.transformOrigin = origin;
        stack.style.transform = isTurned ? 'rotateY(-180deg)' : 'rotateY(0deg)';
      });

      // Classe para ativar sombras durante pequenas animações
      if(animate){
        bookEl.classList.add('flipping');
        clearTimeout(updateView._t);
        updateView._t = setTimeout(()=> bookEl.classList.remove('flipping'), 260);
      }

      // Número de páginas exibidas
      const p1 = turned + 1;
      const p2 = Math.min(turned + 2, PAGES.length);
      pager.textContent = `p. ${p1}–${p2}`;

      // Botões
      const atStart = spreadIndex === 0;
      const atEnd = (spreadIndex >= Math.ceil(PAGES.length/2) - 1);
      prevBtn.disabled = atStart; firstBtn.disabled = atStart;
      nextBtn.disabled = atEnd;   lastBtn.disabled = atEnd;

      // Miniaturas
      [...thumbs.children].forEach((img, i) => {
        const spreadForThumb = Math.floor(i/2);
        img.classList.toggle('active', spreadForThumb === spreadIndex || spreadForThumb === spreadIndex-1 && i%2===1);
      });
    }

    function go(delta){
      const maxSpread = Math.ceil(PAGES.length/2) - 1;
      if(RTL) delta = -delta;
      spreadIndex = Math.max(0, Math.min(maxSpread, spreadIndex + delta));
      updateView();
    }

    function goToStart(){ spreadIndex = RTL? Math.ceil(PAGES.length/2)-1 : 0; updateView(); }
    function goToEnd(){ spreadIndex = RTL? 0 : Math.ceil(PAGES.length/2)-1; updateView(); }

    // Miniaturas
    function renderThumbs(){
      thumbs.innerHTML = '';
      PAGES.forEach((src, i)=>{
        const im = document.createElement('img');
        im.src = src;
        im.alt = 'Miniatura página ' + (i+1);
        im.addEventListener('click', ()=>{
          spreadIndex = Math.floor(i/2);
          updateView();
        });
        thumbs.appendChild(im);
      });
    }

    // Navegação por teclado
    window.addEventListener('keydown', (e)=>{
      if(['ArrowLeft','ArrowRight','Home','End','PageUp','PageDown'].includes(e.key)) e.preventDefault();
      if(e.key==='ArrowRight' || e.key==='PageDown') go(+1);
      if(e.key==='ArrowLeft'  || e.key==='PageUp')   go(-1);
      if(e.key==='Home') goToStart();
      if(e.key==='End')  goToEnd();
    });

    // Navegação por clique nas hotzones
    hotPrev.addEventListener('click', ()=> go(-1));
    hotNext.addEventListener('click', ()=> go(+1));

    // Botões
    prevBtn.addEventListener('click', ()=> go(-1));
    nextBtn.addEventListener('click', ()=> go(+1));
    firstBtn.addEventListener('click', goToStart);
    lastBtn.addEventListener('click', goToEnd);

    // Suporte a toque (swipe)
    let touchX=null;
    document.querySelector('.book-shell').addEventListener('touchstart', e=>{
      touchX = e.touches[0].clientX;
    }, {passive:true});
    document.querySelector('.book-shell').addEventListener('touchend', e=>{
      if(touchX==null) return;
      const dx = (e.changedTouches[0].clientX - touchX);
      if(Math.abs(dx) > 40){ dx<0 ? go(+1) : go(-1); }
      touchX = null;
    });

    // Inicialização
    renderStack();
    renderThumbs();
    updateView(false);
  </script>
</body>
</html>
